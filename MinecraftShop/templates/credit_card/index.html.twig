{% extends 'base.html.twig' %}

{% block title %}Manage Credit Cards{% endblock %}

{% block body %}
<div class="container mx-auto px-4 py-8">
    <h1 class="text-2xl font-bold mb-6">Manage Credit Cards</h1>

    {% for message in app.flashes('success') %}
        <div class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded relative mb-4" role="alert">
            <span class="block sm:inline">{{ message }}</span>
        </div>
    {% endfor %}

    {{ form_start(form, {'attr': {'class': 'space-y-6'}}) }}
        <div class="credit-cards-collection" 
             data-controller="collection-type"
             data-prototype="{{ form_widget(form.creditCards.vars.prototype)|e('html_attr') }}">
            
            {% for creditCardForm in form.creditCards %}
                <div class="credit-card-form mb-4">
                    {{ form_row(creditCardForm.number, {'attr': {'class': 'form-input mt-1 block w-full rounded-md border-gray-300 shadow-sm'}}) }}
                    {{ form_row(creditCardForm.expirationDate, {'attr': {'class': 'form-input mt-1 block w-full rounded-md border-gray-300 shadow-sm'}}) }}
                    {{ form_row(creditCardForm.cvv, {'attr': {'class': 'form-input mt-1 block w-full rounded-md border-gray-300 shadow-sm'}}) }}
                    
                    <button type="button" class="btn-minecraft btn-danger mt-2" onclick="this.closest('.credit-card-form').remove()">
                        Remove Card
                    </button>
                </div>
            {% endfor %}
        </div>

        <button type="button" 
                class="btn-minecraft mt-4"
                data-action="collection-type#addForm">
            Add Another Card
        </button>

        <button type="submit" class="btn-minecraft btn-primary mt-4">
            Save Cards
        </button>
    {{ form_end(form) }}
</div>
{% endblock %}

{% block javascripts %}
    <script src="{{ asset('assets/controllers/collection-type_controller.js') }}"></script>
    <script src="{{ asset('assets/controllers/credit-card-format_controller.js') }}"></script>
    <script src="{{ asset('assets/controllers/expiration-date-format_controller.js') }}"></script>
{% endblock %}